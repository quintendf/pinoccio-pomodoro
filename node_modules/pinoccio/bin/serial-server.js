
// to make sure we can run multiple commands without resetting the board each time i want to fork off this server

var split = require('binary-split');
var through = require('through');
var net = require('net')
var json = require('../lib/json')
var serial = require('../lib/serial');
var fs = require('fs');


var lastMessage = Date.now();
var timeout = 20000;

var server = net.createServer(function(soc){
  var out = soc.pipe(split()).pipe(through(function(data){
    // dont queue
    handle(json(data));    
  }));

  out.pipe(soc);

  function handle(message){
    console.log('message',message);
    // {type:"command",command:"print to serial",port:"device id"};
    // {type:"list"}

    var data = json(message);

    if(data.type == "list"){
      
    }
  }

  var queues = {};
  function run(message){
    var command = message.command;
    var port = message.port;

    if(!queues[port]) ...
  }

}).listen('127.0.0.1',0,function(){
  var addr = server.address();
  addr.pid = process.pid
  console.log('serial server started. ',addr);
});


